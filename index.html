<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>EXPRESSGLASS ‚Ä¢ Rece√ß√£o material</title>

  <!-- ===== CSS EMBUTIDO (moderno + desktop base) ===== -->
  <style>
    :root{
      --bgTop:#1f63ff; --bgBottom:#0b45d9; --bgMid:#1554e8;
      --card:#0f172a; --cardBorder:#1f2937; --text:#e5e7eb; --muted:#a3aed0;
      --accent:#22d3ee; --danger:#ef4444; --success:#10b981;
      --shadowLarge:0 20px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
      color:var(--text);
      background:linear-gradient(135deg,var(--bgTop) 0%,var(--bgMid) 50%,var(--bgBottom) 100%);
      background-attachment:fixed;
    }
    .header{display:flex;align-items:center;justify-content:space-between;padding:24px 20px 8px}
    .brand{display:flex;flex-direction:column;gap:6px;width:100%}
    .title{margin:0;letter-spacing:.08em;font-weight:900;font-size:clamp(32px,6vw,48px)}
    .subtitle,.subtitle-new{margin:0;color:var(--muted);font-weight:600}
    .logo-container{background:#fff;border-radius:15px;padding:12px 16px;margin:0;
      box-shadow:0 4px 15px rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center}
    .logo{max-width:100%;height:auto;max-height:60px}
    .view-badge{display:none}

    /* ===== Cards / desktop ===== */
    .card{
      position:relative;width:min(960px,92vw);margin:16px auto;background:var(--card);
      border:1px solid var(--cardBorder);border-radius:20px;padding:24px;box-shadow:var(--shadowLarge);
      backdrop-filter:blur(10px);
    }
    .toolbar{display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap}
    .btn{background:#1e293b;color:#fff;padding:10px 14px;border-radius:10px;border:1px solid #334155;cursor:pointer}
    .btn.danger{background:#7f1d1d;border-color:#8b2d2d}
    .table-wrap{overflow:auto;border:1px solid var(--cardBorder);border-radius:16px;background:rgba(15,23,42,.5)}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:12px 14px;border-bottom:1px solid #111827;vertical-align:top}
    thead th{position:sticky;top:0;background:#0b1220;z-index:1}

    /* ===== Mobile/desktop switch ===== */
    .mobile-only{display:block} .desktop-only{display:none}
    @media (min-width:900px){ .mobile-only{display:none} .desktop-only{display:block} }

    /* ===== MODERNO (mobile) ===== */
    .modern-mobile{display:flex;flex-direction:column;min-height:calc(100vh - 120px);padding:0;margin:0;width:100%}
    .modern-main{flex:1;display:flex;flex-direction:column;align-items:center;padding:36px 20px 20px}
    .modern-circle{
      width:180px;height:180px;background:#fff;border-radius:50%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      box-shadow:0 20px 40px rgba(0,0,0,.15);margin-bottom:40px;cursor:pointer;position:relative;transition:.25s;
    }
    .modern-circle:active{transform:translateY(1px)}
    .modern-camera-icon{font-size:50px;margin-bottom:8px}
    .modern-camera-label{font-size:14px;font-weight:700;color:#374151}
    .modern-progress-ring{position:absolute;top:-8px;left:-8px;width:196px;height:196px;opacity:.75}
    .modern-progress-ring circle{fill:none;stroke:#22c55e;stroke-width:4;stroke-linecap:round;stroke-dasharray:200 580;animation:spin 1.5s linear infinite}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    .modern-bottom-card{background:#fff;border-radius:25px 25px 0 0;width:100%;min-height:260px;box-shadow:0 -10px 30px rgba(0,0,0,.1);padding:24px 20px}
    .modern-captures-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .modern-captures-title{margin:0;color:#2d3748;font-size:18px;font-weight:800}
    .modern-capture-list{display:flex;flex-direction:column;gap:10px}
    .modern-empty{color:#718096;font-weight:600;text-align:center;padding:24px 0}

    .modern-status{position:fixed;top:18px;left:50%;transform:translateX(-50%);
      background:#10b981;color:#fff;padding:10px 16px;border-radius:16px;font-weight:700;display:none;z-index:1000}
    .modern-status.show{display:block}

    /* ===== Modal Eurocode ===== */
    .modern-eurocode-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:2000;padding:20px}
    .modern-eurocode-modal.show{display:flex}
    .modern-modal-content{background:#fff;border-radius:18px;width:100%;max-width:420px;box-shadow:0 20px 40px rgba(0,0,0,.3);overflow:hidden}
    .modern-modal-header{display:flex;align-items:center;gap:10px;padding:18px 20px;border-bottom:1px solid #e2e8f0}
    .modern-modal-title{margin:0;color:#2d3748;font-size:18px;font-weight:800}
    .modern-modal-body{padding:16px 20px;max-height:55vh;overflow:auto}
    .modern-ocr-label,.modern-eurocodes-label{display:block;font-size:14px;font-weight:700;color:#4a5568;margin:8px 0}
    .modern-ocr-text{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:10px;color:#2d3748;font-size:12px;white-space:pre-wrap}
    .modern-eurocode-list{display:flex;flex-direction:column;gap:8px}
    .modern-eurocode-button{background:#3182ce;color:#fff;border:0;border-radius:8px;padding:12px 14px;font-size:14px;font-weight:700;cursor:pointer}
    .modern-modal-footer{display:flex;gap:10px;padding:16px 20px;border-top:1px solid #e2e8f0}
    .modern-modal-btn{flex:1;padding:10px 14px;border-radius:8px;border:0;font-weight:800;cursor:pointer}
    .modern-btn-secondary{background:#6b7280;color:#fff}
    .modern-btn-danger{background:#ef4444;color:#fff}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="brand">
      <div class="logo-container">
        <img src="expressglass-logo.png" class="logo" alt="ExpressGlass - Vidros para Viaturas" />
      </div>
      <h1 class="title">EXPRESSGLASS</h1>
      <p class="subtitle">Rece√ß√£o material</p>
      <p class="subtitle-new">Rece√ß√£o material</p>
    </div>
    <div class="view-badge" id="viewBadge">Mobile</div>
  </header>

  <!-- Input da c√¢mara (partilhado) -->
  <input id="cameraInput" type="file" accept="image/*" capture="environment" hidden />

  <!-- ===== MOBILE MODERNO (√∫nico) ===== -->
  <main class="modern-mobile mobile-only">
    <div id="modernStatus" class="modern-status">A processar‚Ä¶</div>

    <div class="modern-main">
      <div class="modern-circle" id="modernCameraButton">
        <svg class="modern-progress-ring"><circle cx="98" cy="98" r="92"></circle></svg>
        <div class="modern-camera-icon">üì∑</div>
        <div class="modern-camera-label">Eurocode</div>
      </div>
    </div>

    <div class="modern-bottom-card">
      <div class="modern-captures-header">
        <span class="modern-captures-icon">üìã</span>
        <h2 class="modern-captures-title">√öltimas Capturas</h2>
      </div>
      <div id="modernCapturesList" class="modern-capture-list">
        <div class="modern-empty">Ainda n√£o h√° capturas</div>
      </div>
    </div>
  </main>

  <!-- Modal Eurocode -->
  <div id="modernEurocodeModal" class="modern-eurocode-modal" aria-modal="true" role="dialog">
    <div class="modern-modal-content">
      <div class="modern-modal-header">
        <span class="modern-modal-icon">üîç</span>
        <h3 class="modern-modal-title">Selecionar Eurocode</h3>
      </div>
      <div class="modern-modal-body">
        <label class="modern-ocr-label">Texto lido:</label>
        <div id="modernOcrText" class="modern-ocr-text"></div>

        <label class="modern-eurocodes-label">Eurocodes encontrados: Clique no correto</label>
        <div id="modernEurocodeList" class="modern-eurocode-list"></div>
      </div>
      <div class="modern-modal-footer">
        <button id="modernBtnNoEurocode" class="modern-modal-btn modern-btn-secondary">Sem Eurocode</button>
        <button id="modernBtnCancel" class="modern-modal-btn modern-btn-danger">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ===== DESKTOP (intacto) ===== -->
  <section id="desktopView" class="card desktop-only">
    <button class="help-btn" id="helpBtnDesktop" aria-label="Ajuda" style="position:absolute;top:20px;right:20px;width:36px;height:36px;border-radius:50%;border:1px solid #334155;background:#111827;color:#a3aed0;">?</button>
    <div class="toolbar">
      <button id="btnUpload" class="btn">üìÅ Carregar imagem</button>
      <input id="fileInput" type="file" accept="image/*,.pdf" hidden />
      <button id="btnExport" class="btn">üìä Exportar CSV</button>
      <button id="btnClear" class="btn danger">üóëÔ∏è Limpar Tabela</button>
    </div>
    <div class="table-wrap">
      <table id="resultsTable">
        <thead>
          <tr>
            <th style="width:60px">#</th>
            <th style="width:220px">Data/Hora</th>
            <th style="width:auto">Texto lido (Eurocode)</th>
            <th style="width:180px">Eurocode</th>
            <th style="width:140px">A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
    </div>
    <div id="desktopStatus" class="status" style="margin-top:10px;color:#a3aed0"></div>
  </section>

  <!-- Modais originais (mantidos no teu projeto) -->
  <div id="helpModal" class="help-modal" style="display:none"></div>
  <div id="editOcrModal" class="edit-ocr-modal" style="display:none"></div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- O teu JS principal (OCR/BD/etc.) -->
  <script src="app.js"></script>

  <!-- JS m√≠nimo para abrir c√¢mara + modal moderno -->
  <script>
    const cameraInput = document.getElementById('cameraInput');
    const modernBtn = document.getElementById('modernCameraButton');
    const modernStatus = document.getElementById('modernStatus');
    const euroModal = document.getElementById('modernEurocodeModal');
    const ocrTextEl = document.getElementById('modernOcrText');
    const euroListEl = document.getElementById('modernEurocodeList');
    const btnNoEuro = document.getElementById('modernBtnNoEurocode');
    const btnCancel = document.getElementById('modernBtnCancel');

    // Abre a c√¢mara diretamente
    if (modernBtn) {
      modernBtn.addEventListener('click', () => {
        if (cameraInput) cameraInput.click();
      });
    }

    // Quando escolher imagem, delega para o teu app.js SE ele estiver a escutar "cameraInput"
    // Caso n√£o esteja, deixo aqui um fallback simples que dispara um evento custom.
    if (cameraInput) {
      cameraInput.addEventListener('change', (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        // Notifica o app.js (se escutar este evento)
        document.dispatchEvent(new CustomEvent('camera-image-selected', { detail: { file } }));
      });
    }

    // ===== API p√∫blica para o app.js abrir o modal moderno =====
    // Chama window.showEurocodePicker(ocrText, eurocodesArray)
    window.showEurocodePicker = function(ocrText, eurocodes){
      modernStatus.classList.add('show');
      modernStatus.textContent = 'Texto lido';
      setTimeout(() => modernStatus.classList.remove('show'), 1500);

      ocrTextEl.textContent = ocrText || '';
      euroListEl.innerHTML = '';
      if (Array.isArray(eurocodes) && eurocodes.length){
        eurocodes.forEach(code => {
          const b = document.createElement('button');
          b.className = 'modern-eurocode-button';
          b.textContent = code;
          b.addEventListener('click', () => {
            euroModal.classList.remove('show');
            // exp√µe evento para o app.js tratar do save
            document.dispatchEvent(new CustomEvent('eurocode-selected', { detail: { code, ocrText } }));
          });
          euroListEl.appendChild(b);
        });
      } else {
        const d = document.createElement('div');
        d.style.color = '#718096'; d.style.fontWeight='600';
        d.textContent = 'Nenhum eurocode identificado';
        euroListEl.appendChild(d);
      }
      euroModal.classList.add('show');
    };

    btnNoEuro?.addEventListener('click', () => {
      euroModal.classList.remove('show');
      const text = ocrTextEl.textContent || '';
      document.dispatchEvent(new CustomEvent('eurocode-selected', { detail: { code: '', ocrText: text } }));
    });
    btnCancel?.addEventListener('click', () => euroModal.classList.remove('show'));
  </script>
</body>
</html>