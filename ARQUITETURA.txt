╔═══════════════════════════════════════════════════════════════════════════════╗
║                    ARQUITETURA EXPRESSGLASS/PARABRISAS                        ║
║                           Sistema de Gestão de Vidros                         ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────────┐
│                              MENU INICIAL (Mobile)                            │
│                                                                               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │
│  │   ENTRADA   │    │    SAÍDA    │    │  INVENTÁRIO │                      │
│  │      📦     │    │      📤     │    │      📋     │                      │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                      │
│         │                  │                   │                              │
└─────────┼──────────────────┼───────────────────┼──────────────────────────────┘
          │                  │                   │
          └──────────┬───────┘                   │
                     ▼                           ▼
    ┌────────────────────────────┐   ┌────────────────────────────┐
    │      SISTEMA RECEÇÃO       │   │    SISTEMA INVENTÁRIO      │
    │       (index.html)         │   │    (inventario.html)       │
    └────────────────────────────┘   └────────────────────────────┘
                 │                                │
                 │                                │
    ┌────────────▼────────────┐      ┌───────────▼────────────┐
    │       app.js            │      │   inventario-novo.js   │
    │                         │      │                        │
    │  • Captura OCR          │      │  • Captura OCR         │
    │  • Modal REDE/COMP/OEM  │      │  • Modal REDE/COMP/OEM │
    │  • Modo Entrada         │      │  • Listagem Cards      │
    │  • Modo Saída           │      │  • Totalizadores       │
    │  • Edição Inline        │      │  • Eliminação          │
    │  • Exportar/Imprimir    │      │  • Exportar Excel      │
    └─────────────┬───────────┘      └────────────┬───────────┘
                  │                               │
                  │                               │
    ┌─────────────▼───────────┐      ┌───────────▼────────────┐
    │  FUNÇÕES NETLIFY        │      │  FUNÇÕES NETLIFY       │
    │  (Receção)              │      │  (Inventário)          │
    │                         │      │                        │
    │  • save-ocr.mjs         │      │  • save-inventario.mjs │
    │  • list-ocr.mjs         │      │  • list-inventario.mjs │
    │  • clear-ocr.mjs        │      │  • clear-inventario.mjs│
    │  • delete-ocr.mjs       │      │  • delete-inventario.mjs│
    │  • edit-ocr.mjs         │      │                        │
    │  • update-ocr.mjs       │      │                        │
    └─────────────┬───────────┘      └────────────┬───────────┘
                  │                               │
                  │                               │
    ┌─────────────▼───────────┐      ┌───────────▼────────────┐
    │  BASE DE DADOS          │      │  BASE DE DADOS         │
    │  (PostgreSQL/Neon)      │      │  (PostgreSQL/Neon)     │
    │                         │      │                        │
    │  Tabela: ocr_results    │      │  Tabela: inventario    │
    │                         │      │                        │
    │  Campos:                │      │  Campos:               │
    │  • id                   │      │  • id                  │
    │  • ts                   │      │  • ts                  │
    │  • text                 │      │  • text                │
    │  • eurocode             │      │  • eurocode            │
    │  • brand                │      │  • brand               │
    │  • vehicle              │      │  • vehicle             │
    │  • filename             │      │  • filename            │
    │  • source               │      │  • source              │
    │  • matricula            │      │  • matricula           │
    │  • loja                 │      │  • loja                │
    │  • observacoes          │      │  • observacoes         │
    │  • tipo                 │      │  • user_id             │
    │  • user_id              │      │                        │
    └─────────────────────────┘      └────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────┐
│                           COMPONENTES PARTILHADOS                             │
│                                                                               │
│  • auth.js - Autenticação JWT                                                │
│  • auth-utils.mjs - Utilitários de autenticação                              │
│  • db.mjs - Conexão à base de dados                                          │
│  • eurocode-mapping.mjs - Mapeamento de eurocodes                            │
│  • ocr-claude.mjs - Processamento OCR com IA                                 │
│  • style.css - Estilos globais                                               │
│  • menu-inicial.js - Menu mobile                                             │
│  • modal-saida.js - Modal de saída                                           │
└───────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────┐
│                              FLUXO DE DADOS                                   │
└───────────────────────────────────────────────────────────────────────────────┘

RECEÇÃO (ENTRADA):
  Utilizador → Câmera → Modal Tipo → OCR → save-ocr.mjs → ocr_results → Tabela

RECEÇÃO (SAÍDA):
  Utilizador → Botão Saída → delete-ocr.mjs → Remove de ocr_results → Atualiza

INVENTÁRIO:
  Utilizador → Câmera → Modal Tipo → OCR → save-inventario.mjs → inventario → Cards

┌───────────────────────────────────────────────────────────────────────────────┐
│                         PREFIXOS DE CLASSIFICAÇÃO                             │
└───────────────────────────────────────────────────────────────────────────────┘

  🔵 REDE          → Sem prefixo      (ex: 43R-001234)
  🟣 COMPLEMENTAR  → Prefixo #        (ex: #43R-001234)
  🟠 OEM           → Prefixo *        (ex: *43R-001234)

┌───────────────────────────────────────────────────────────────────────────────┐
│                              AUTENTICAÇÃO                                     │
└───────────────────────────────────────────────────────────────────────────────┘

  Login → JWT Token → Armazenado em localStorage → Enviado em cada request
  
  Isolamento de dados por user_id:
  • Cada utilizador vê apenas os seus próprios dados
  • Receção e Inventário são independentes mas ambos isolados por utilizador

